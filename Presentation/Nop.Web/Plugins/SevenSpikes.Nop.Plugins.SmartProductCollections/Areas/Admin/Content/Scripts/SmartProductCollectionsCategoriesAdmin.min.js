!function(i){var a=function(r){var t,e,o=i(".category-tabs-editor-wrapper"),a=o.children(".category-tabs-editor");a.empty(),o.show().children(".loader").show(),i.ajax({url:i(".category-autocomplete-wrapper").attr("data-getProductsGroupTabsUrl"),type:"POST",data:(t=r,e={groupId:t},e=addAntiForgeryToken(e))}).done(function(t){a.html(t),i.event.trigger({type:"newProductGroupAddedEvent"}),i.event.trigger({type:"initializeCustomCategoryMappingPanel"})}).always(function(){var t,e,a=i('.sortable[data-productGroupId="'+r+'"]').children("span:first").text();t=a,0===(e=i(".tab-builder-title")).children(".tab-category-title").length&&e.append('<span class="tab-category-title"></span>'),e.children(".tab-category-title").text(" ("+t+")"),o.children(".loader").fadeOut()})};function s(){var t=0,e=i("#store-scope-configuration");if(0<e.length){var a=e.val().split("?")[1];if(null!=a&&null!=(a=a.split("&")[0])){var r=a.split("=");void 0!==r[1]&&"storeid"===r[0].toLowerCase()&&(t=parseInt(r[1]))}}return t}var n=function(){var t,r="";i(".categories-sortable-list span.sortable[data-categoryid]").each(function(){var t=i(this),e=parseInt(t.attr("data-categoryid"))||0,a=parseInt(t.attr("data-productGroupId"))||0;r+=e+":"+a,0<t.next("span.sortable[data-categoryid]").length&&(r+=",")}),i("#CategoryGroupIds").val(r),t={categoryGroupIds:i("#CategoryGroupIds").val(),storeId:s()},t=addAntiForgeryToken(t),i.ajax({url:i(".category-autocomplete-wrapper").attr("data-saveCategoryGroupIdsSettingUrl"),type:"POST",data:t})},e=function(t){var e,a,r=i(t),o=parseInt(r.attr("data-categoryId"))||0;0<i('.categories-sortable-list span[data-categoryId="'+o+'"]').length||(r.addClass("sortable"),r.append('<span class="edit-item-button" title="Edit"><i class="fa fa-pencil" aria-hidden="true"></i></span>'),r.append('<span class="remove-category-item remove-item-button" title="Remove"><i class="fa fa-times" aria-hidden="true"></i></span>'),i.ajax({url:i(".category-autocomplete-wrapper").attr("data-createProductsGroupUrl"),type:"POST",data:(e=o,a={categoryId:e,storeId:s()},a=addAntiForgeryToken(a))}).done(function(t){i('.categories-sortable-list span[data-categoryId="'+o+'"]').attr("data-productGroupId",t.toString()),i('.categories-sortable-list span[data-productgroupid="'+t+'"] .edit-item-button').click()}).always(function(){n()}),i(".categories-sortable-list").append(r))},t=function(){var t={categoryName:i("#choose-category-autocomplete").val()||""};return t=addAntiForgeryToken(t)},r=function(t,e){0!==i("#"+t).length&&(i("#"+t).is(":checked")?i(".overlay-for-"+t).remove():i(e).append('<div class="custom-fields-overlay overlay-for-'+t+'"></div>'))},o=function(t,e){var a=i(e);"static"===a.css("position")&&a.css("position","relative"),i("#"+t).change(function(){r(t,e)}),r(t,e)};i(document).ready(function(){i("#choose-category-autocomplete").kendoAutoComplete({dataTextField:"name",filter:"contains",highlightFirst:!0,dataSource:{serverFiltering:!0,transport:{read:{url:i(".category-autocomplete-wrapper").attr("data-getCategoriesUrl"),dataType:"json",data:t}}},template:kendo.template(i("#categoriesSortingTemplate").html()),change:function(){var t=i("#choose-category-autocomplete_listbox .k-state-selected").html();this.value(""),e(t),n()}}),i(".categories-sortable-list").kendoSortable({filter:"span.sortable",container:i(".categories-sortable-list"),hint:function(t){return i('<div class="sortable-categories-drag-drop-hint">'+t.html()+"</div>")},change:n}),i(".categories-sortable-list").on("click",".remove-category-item",function(){var t=i(this).closest(".sortable[data-categoryid]");t.is(".active")&&i(".category-tabs-editor-wrapper").hide(),t.remove(),n()}),i(".categories-sortable-list").on("click",".edit-item-button",function(){var t=i(this).closest(".sortable[data-categoryid]"),e=t.attr("data-productGroupId");t.addClass("active").siblings(".sortable").removeClass("active"),a(e)}),i(".store-scope-configuration .checkbox input").change(function(){o("CategoryGroupIds_OverrideForStore",".choosed-categories-holder")}),o("CategoryGroupIds_OverrideForStore",".choosed-categories-holder")})}(jQuery);